<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Eye test</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, Helvetica, sans-serif;
        background: black;
      }
      body {
        margin: auto;
        display: flex;
        align-items: center;
        justify-content: center;
        user-select: none;
        padding-bottom: 20vh;
      }
      v-cloak {
        display: none;
      }
      #app {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .tips {
        color: #666;
        margin: 2em 0 2em;
        text-align: center;
      }
      .tips .section {
        margin-top: 1em;
        text-align: start;
      }
      .red-green {
        display: flex;
        margin-top: 4rem;
        width: 36rem;
      }
      .side {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 2rem;
        justify-content: flex-end;
        padding: 4em 2em 4em 2em;
        padding-inline-start: 0;
        overflow: hidden;
      }
      .side.red {
        background: oklch(62% 0.22 28);
      }
      .side.green {
        background: oklch(62% 0.22 144);
      }
      .side.white {
        background: white;
      }
      .side.flip {
        direction: rtl;
      }
      .letters {
        display: flex;
        flex-direction: column;
        color: #000;
        font-weight: bold;
        gap: 16px;
      }
      .letters .line {
        display: flex;
        align-items: baseline;
        gap: 0.5em;
      }
      .line > span {
        width: 1em;
        text-align: center;
      }
      .letters .size {
        font-size: 0.5em;
      }

      .shapes {
        display: flex;
        gap: 24px;
        margin-inline-start: -2rem;
      }
      .shape {
        width: 4rem;
        height: 4rem;
        box-sizing: border-box;
      }
      .circle {
        border-radius: 50%;
        border: 4px solid #000;
      }
      .shape.outer {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .shape.inner {
        width: 75%;
        height: 75%;
      }
      .square {
        border: 4px solid #000;
        border-radius: 0;
      }

      section {
        min-height: 100vh;
      }
      .astig {
        width: 440px;
        height: 440px;
        background: #fff;
        border-radius: 50%;
        padding: 20px;
      }
      .astig .spoke {
        stroke: #000;
        stroke-width: 1;
        stroke-linecap: round;
        stroke-dasharray: 10, 5;
      }
    </style>
  </head>
  <body>
    <div id="app" v-cloak>
      <div class="tips">
        âš ï¸æ³¨æ„ï¼šæœ¬å·¥å…·å¯ç”¨äºæ£€æµ‹è§†åŠ›æ°´å¹³ï¼Œä½†æ— æ³•ç”¨ä½œä¸“ä¸šçš„è§†åŠ›æ£€æµ‹å·¥å…·ã€‚<br />
        ğŸ’¡è¯·åœ¨è‰¯å¥½çš„å…‰çº¿æ¡ä»¶ä¸‹ä½¿ç”¨æœ¬å·¥å…·ã€‚
      </div>
      <section>
        <div class="tips" style="text-align: initial">
          <h2>çº¢ç»¿æµ‹è¯•</h2>
          æµ‹é‡æé™è§†åŠ›è·ç¦»ã€‚å»ºè®®å•çœ¼æµ‹è¯•ã€‚
          <ol>
            <li>ç¦»è¿œå±å¹•ç›´åˆ°ç»¿è‰²æ˜æ˜¾æ¨¡ç³Š</li>
            <li>é è¿‘å±å¹•ç›´åˆ°ç»¿è‰²å˜å¾—æ¸…æ™°å¯è§ï¼Œä¸”æ¸…æ™°åº¦åŸºæœ¬ä¸çº¢è‰²æŒå¹³</li>
            <li>å¦‚æœç»¿è‰²æ¸…æ™°ä½†çº¢è‰²æ¨¡ç³Šï¼Œè¯´æ˜è·ç¦»è¿‡è¿‘</li>
            <li>ç‚¹å‡»å·¦ä¾§é‡æ–°ç”Ÿæˆå­—æ¯ï¼Œç‚¹å‡»å³ä¾§åˆ‡æ¢é¢œè‰²</li>
          </ol>
        </div>
        <div class="red-green" @click="handleSwapColor">
          <div
            class="side"
            :class="[((colorMode === 'red-green') === flip) ? 'red' : 'green', { white: colorMode === 'white' }, { flip }]"
            v-for="flip in [true, false]"
            @click="handleSideClick(flip)"
          >
            <div class="letters">
              <div
                v-for="(line, index) in letterLines"
                :key="index"
                class="line"
                :style="{
                  fontSize: `${letterSizes[index]}px`,
                  marginInlineStart: `${(letterSizes[index] - 4) / 2}px`,
                }"
              >
                <span v-for="letter in line" :key="letter">{{ letter }}</span>
                <div class="size">{{ letterSizes[index] }}</div>
              </div>
            </div>
            <div class="shapes">
              <div class="shape circle outer">
                <div class="shape circle inner"></div>
              </div>
              <div class="shape circle outer" style="scale: 0.75">
                <div class="shape circle inner"></div>
              </div>
              <div class="shape square outer">
                <div class="shape square inner"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section>
        <div class="tips" style="text-align: initial">
          <h2>æ•£å…‰æµ‹è¯•</h2>
          åŠ¡å¿…å•çœ¼æµ‹è¯•ã€‚<br />
          <ol>
            <li>ç§»åŠ¨åˆ°å›¾ç‰‡åŸºæœ¬æ¸…æ™°çš„è·ç¦»</li>
            <li>è§‚å¯Ÿæ˜¯å¦æœ‰æŸäº›æ–¹å‘çš„çº¿æ¡å’Œå…¶ä»–æ–¹å‘æ˜æ˜¾ä¸åŒ</li>
            <li>æ‰­åŠ¨å¤´éƒ¨ï¼Œè§‚å¯Ÿçº¿æ¡æ˜¯å¦æœ‰å˜åŒ–</li>
          </ol>
        </div>
        <div class="astig" role="img" aria-label="æ•£å…‰æµ‹è¯•åœˆ">
          <svg
            viewBox="0 0 200 200"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <circle cx="100" cy="100" r="2" fill="#000" />

            <g class="spokes">
              <g
                :transform="`rotate(${angle} 100 100)`"
                v-for="angle in astigAngles"
              >
                <text
                  v-if="angle % 30 === 0"
                  x="100"
                  y="10"
                  font-size="12"
                  text-anchor="middle"
                >
                  {{ angle === 90 ? 0 : 180 - ((angle + 90) % 180) }}
                </text>
                <line class="spoke" x1="100" y1="20" x2="100" y2="85" />
              </g>
            </g>
          </svg>
        </div>
      </section>
    </div>
    <script type="module">
      import {
        createApp,
        ref,
        computed,
        onMounted,
        watch,
      } from "https://cdn.jsdelivr.net/npm/vue@3/dist/vue.esm-browser.prod.js";

      const CHARS = "CDHKNORSVZ";
      const COLOR_MODES = ['red-green', 'green-red', 'white'];

      function randomChar() {
        return CHARS.charAt(Math.floor(Math.random() * CHARS.length));
      }

      const app = createApp({
        setup() {
          const generateLetterLines = () => {
            return Array.from({ length: 10 }, () => {
              const line = [];
              for (let i = 0; i < 3; i++) {
                while (true) {
                  const char = randomChar();
                  if (!line.includes(char)) {
                    line.push(char);
                    break;
                  }
                }
              }

              return line;
            });
          };
          const letterLines = ref(generateLetterLines());

          const letterSizes = computed(() => {
            let size = 8;
            const sizes = [];
            for (let i = 0; i < letterLines.value.length; i++) {
              sizes.push(size);
              size += 4;
            }
            return sizes.reverse();
          });

          const astigAngles = computed(() => {
            const interval = 10;
            const angles = [];
            for (let angle = 0; angle < 360; angle += interval) {
              angles.push(angle);
            }
            return angles;
          });

          const colorModeValue = ref(0);
          const colorMode = computed(() => {
            return COLOR_MODES[colorModeValue.value];
          });
          const handleSideClick = (flipSide) => {
            if (flipSide) {
              letterLines.value = generateLetterLines();
            } else {
              colorModeValue.value = (colorModeValue.value + 1) % COLOR_MODES.length;
            }
          };
          return {
            colorMode,
            astigAngles,
            letterLines,
            letterSizes,
            handleSideClick,
          };
        },
      });

      app.mount("#app");
    </script>
  </body>
</html>
